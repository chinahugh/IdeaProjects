
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
<%@ page language="java" import="java.util.*"  pageEncoding="utf-8"%>
 
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>上传客户端软件</title>
 
 
<script type="text/javascript">
 $(document).ready(function(){
        //初始化uploadify 用于word上传
                        $("#doc_upload").uploadify({
                                            'swf' : '/js/uploadify/uploadify.swf',//上传的flash文件,必用
                                            'uploader' : '/upload.action;jsessionid=<%=request.getSession().hashCode()%>',//上传的请求URL
                                            //'script' : '/upload.action',
                                            'method' : "post",//请求方式
                                            //'folder' : 'upload',//设置上传文件夹
                                            'cancelImage' : '/js/uploadify/uploadify-cancel.png',//设置取消的图片
                                            'displayData' : 'speed',//进度条的显示方式
                                            'fileObjName' : 'file',//与后台Action中file属性一样
                                            'formData' : {
                                                'folder' : '/upload/soft'
                                            },//附带值，参数
                                            'queueID' : 'doc_pb',//进度条ID
                                            'auto' : true,//自动上传
                                            'multi' : false,//是否为多文件上传
                                            'buttonImage':'/images/upload.png',
                                            'button Text' : " 浏 览 ",
                                            'uploadLimit' : 1,//一次可以上传多少个文件
                                            'fileSizeLimit' : '100000KB',//单个文件上传最大值
                                            'queueSizeLimit' : 1,//最多上传个数
                                            successTimeout : 99999,//上传超时时间
                                            'fileTypeDesc' : '支持格式:*.exe',//提示上传格式
                                            'fileTypeExts' : '*.exe',//限制上传文件格式
                                            'rollover' : true,
                                            'removeCompleted' : false,//上传完成后是否自动隐藏进度条
                                            //'debug' : true,
                                            progressData : "percentage",//显示上传的百分比
                                            //上传到服务器，服务器返回相应信息到data里
                                            onUploadSuccess : function(file,//每个文件上传完成后都会调用一次，其中data为，相应信息，file为上传文件信息,response只有两个值true or false
                                                    data, response) {
                                                //alert(response);
                                                //alert(file);
                                                //alert(data);
                                                $("#doc_path").val(data);
                                            },
                                            //选择文件时出错
                                            onSelectError : function(file,
                                                    errorCode, errorMsg) {
                                                alert(errorMsg);
                                            },
                                            onError : function(errorObj) {
                                                alert(errorObj.info
                                                        + "               "
                                                        + errorObj.type);
                                            }
                                        });
                    });
                     
    function navTabAjaxDone(json){
         //DWZ.ajaxDone(json);
         if (json.statusCode == DWZ.statusCode.ok){
            if ("queryData"){ //把指定navTab页面标记为需要“重新载入”。注意navTabId不能是当前navTab页面的
                  navTab.reloadFlag("lastestVersion");
            } else { //重新载入当前navTab页面
                  navTabPageBreak();
            }
            if ("closeCurrent" == json.callbackType) {
                  setTimeout(function(){navTab.closeCurrentTab();}, 100);
            } else if ("forward" == json.callbackType) {
                  navTab.reload(json.forwardUrl);
            }
      }
}
</script>
</head>
<body>
    <form enctype="multipart/form-data" action="/updateVersion" method="post" class="pageForm required-validate" onsubmit="return validateCallback(this, navTabAjaxDone);">
    <input id="doc_path"  name="path"  type="hidden" >
    <div class="pageFormContent nowrap" layoutH="56">
        <dl><dt>版&nbsp;&nbsp;本&nbsp;&nbsp;号：</dt><dd><input name="versionNum"  type="text"  class="required"></dd></dl>
        <dl><dt>上传软件：</dt><dd><input type="file" name="doc" id="doc_upload"  >
        <div id="doc_pb"></div></dd></dl>
            <div class="formBar" style="margin-top: 600px">
                <ul>
                    <!--<li><a class="buttonActive" href="javascript:;"><span>保存</span></a></li>-->
                    <li><div class="buttonActive">
                            <div class="buttonContent">
                                <button type="submit">保存</button>
                            </div>
                        </div></li>
                    <li>
                        <div class="button">
                            <div class="buttonContent">
                                <button type="button" class="close">取消</button>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
    </div>
    </form>
</body>
</html>